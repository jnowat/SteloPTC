// Auto-generated by `cargo tauri android init` — do not edit manually.
// Registers the Tauri Rust/NDK Gradle plugin and sets cross-compilation config.

import groovy.json.JsonSlurper

// ── Locate src-tauri/ directory ───────────────────────────────────────────────
// rootProject.projectDir = src-tauri/gen/android/
// .parentFile            = src-tauri/gen/
// .parentFile            = src-tauri/              ← Cargo.toml lives here
def srcTauriDir = rootProject.projectDir.parentFile.parentFile

// ── Read tauri.conf.json ─────────────────────────────────────────────────────
def tauriConfFile = new File(srcTauriDir, "tauri.conf.json")
def tauriConf     = new JsonSlurper().parseText(tauriConfFile.text)

// ── NDK version ──────────────────────────────────────────────────────────────
// Reads from bundle.android.ndkVersion (e.g. "r27") and maps to a full version.
def ndkVersionShort = tauriConf?.bundle?.android?.ndkVersion ?: "r27"
def ndkVersionMap   = [
    "r27": "27.2.12479018",
    "r26": "26.3.11579264",
    "r25": "25.2.9519653",
]
ext {
    ndkVersion    = ndkVersionMap[ndkVersionShort] ?: "27.2.12479018"
    minSdkVersion = tauriConf?.bundle?.android?.minSdkVersion ?: 24
}

// ── Rust / NDK build plugin ───────────────────────────────────────────────────
// The `rust` plugin is provided by the tauri-cli Gradle plugin distribution.
// It invokes `cargo ndk` to compile Rust to each target ABI and copies the
// resulting .so files into src/main/jniLibs/ before the Android build runs.
buildscript {
    repositories {
        google()
        mavenCentral()
        maven { url = uri("https://jitpack.io") }
    }
    dependencies {
        classpath("com.android.tools.build:gradle:8.5.2")
        classpath("org.jetbrains.kotlin:kotlin-gradle-plugin:2.0.21")
        // Tauri Rust plugin for Android NDK builds
        classpath("app.tauri:gradle-plugin:2.0.0")
    }
}
